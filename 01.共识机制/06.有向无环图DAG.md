## **有向无环图**

![img](D:\blockchain_github\01.共识机制\imags\a3.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)

 图3

### **Tip的概念**


 在DAG中，如图所示，方块（vertex）表示的是一笔笔的交易，而虚线（edge）表示的是验证关系。每一个新加入的交易都需要挑两个没有被验证过的交易来验证这两个交易的合法性。方块6就是还未被验证过的交易，也称为tip。tip是DAG最重要的概念。

### **交易到达率和网络延迟对DAG的影响**


 两个网络指标会对DAG的结构有影响，分别是：交易到达率\lambda和网络延迟\tau

我们假设交易到达率\lambda满足泊松过程（Poisson point rocess）:其物理意义是在单位时间内有多少交易会到达DAG网络。

那么会存在两种特殊情况

当\lambda=0.1时，DAG就变成了区块链网络，如下图所示。因为新加入的交易只能验证一个未被验证过的tip，例如：新加入的交易11只能验证tip10。
 ![在这里插入图片描述](D:\blockchain_github\01.共识机制\imags\a4.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​

当\lambda特别大时，且DAG网络只有一个创世区块时，就会发现如下图所示的情况。
 ![在这里插入图片描述](D:\blockchain_github\01.共识机制\imags\a5.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​

图4 

那么为什么交易11不能验证交易1呢？这是因为网络时延\tau的存在，使得交易11不知道1的存在。灰色方块表示的是在网络延迟\tau内到达的数据，从而使得他们互相都不知道彼此的存在，因此不能够进行验证。

### **新交易的Tip选择策略**

 那么讨论完特殊情况，在一般情况下，一个新加入的交易是如何选择哪一个tip去验证呢？要设计一种策略，防止lazy tip的产生。所谓的lazy tip指的是喜欢验证旧的交易，而不是最近的交易。
 ![在这里插入图片描述](D:\blockchain_github\01.共识机制\imags\a6png.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​

图5

那么有两种思维方式：基于概率的策略和非基于概率的策略。

（2）基于概率的策略
 基于概率的策略在白皮书中指的是累积加权随机游走策略（当时实际情况可能会调整）。当一个新交易加入到DAG网络，他需要通过一定的策略来选择验证网络中哪一个最新出现的tip。

具体操作流程为：让一个walker从创世区块开始走，然后根据下一个交易的权重来计算选择概率，就这么不断选择不断走，直到到达tip。例如：Walker 从交易0开始走，他有四个选择（2，3，1，4），根据交易（2，3，1，4）的各自权重来计算其被Walker选择到的概率。

一个交易的权重的计算公式为：1 + 直接或者间接验证过他的交易的数目。如图所示，交易3的权重的计算方式为：1（红色线） +4（交易5 7 8 10）=5
 ![在这里插入图片描述](D:\blockchain_github\01.共识机制\imags\a7.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​

图6 

（2）非基于概率的策略
 那么如果不用基于概率的策略，而是采用非基于概率的策略，也就是超权重随机游走策略。其策略思想是：Walker只选择权重最大的交易，而不是以一定的概率来选择概率。这样做的会导致：
 ![在这里插入图片描述](D:\blockchain_github\01.共识机制\imags\a8.png)![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)​

图7

灰色代表的是tips，他会随着时间越积攒越多。

### **DAG的优点**


 根据区块链的不可能三角理论：分布式，安全性，高效性不可能同时兼得。DAG理论上可以实现分布式和高效性，因此安全性可能就会被诟病。

DAG相比于目前的公链技术，其实是图和链的区别，对于链而言，无法只处理一个局部，因为链的入度和出度只有一个，不能把链上的节点拆成好几个节点去处理，但是对于图却可以，因为图可以有多个出度，那么可以同时处理多个出度连接的节点。所以，它的特点是：

1. 交易速度块，DAG实现的局部处理和并行结算可以使得交易速度大幅度提升。
2. 拓展性强，因为各个节点无需等待同步其他的节点的数据就可计算使得记账节点很容易答复延展，因此DAG很适用于物联网类项目，例如机器微支付。
3. 作恶难度更大，相比于链式结构，在DAG中恶意修改的难度会大很多，因为DAG拥有着很多的出度和入度，假如要修改某一个节点，那么对应的出入度都要进行修改。
4. 支持并发交易，吞吐量高
5. 没有交易费用

对于链式网络而言，不是节点的处理能力不强，只是链式结构不能并行计算，浪费的时间其实主要为等待时间：一个是发起交易，需要将交易同步所有节点，另一个是当有一个节点确认，需要向全网同步。

### 缺点

1. 天生不支持智能合约，限制了其应用场景
2. 只有当网络形成一定规模时，DAG才可以安全的被应用。所有的DAG项目还是暂时采用中心化的共识策略：因为网络规模不够
3. 安全性有待验证

### 总结

有向无环图是计算机科学中众所周知的数据结构。事实上，区块链也是DAG的一个例子，因为它有一个明确的方向，没有任何循环，并且是一个图。1OTA使用的Tangle也是DAG共识机制的一种形式。在这种机制中，每个块必须有两个父块。所以，为了通过DAG共识机制完成一笔交易，用户需要验证自己之前的两笔交易。这种机制的最大优势是它可以减少延迟和交易费用。然而，这种共识模型对提高可扩展性几乎没有任何作用，而且极易受到攻击，因为任何攻击只需要34%的哈希算力就可以破坏系统。